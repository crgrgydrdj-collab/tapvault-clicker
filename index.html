<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>TapVault</title>

<style>
/* ====== ДИЗАЙН (НЕ ТРОГАЛ, 1-в-1) ====== */
:root{
  --fg: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --glass: rgba(0,0,0,.35);
  --stroke: rgba(255,255,255,.10);
  --accent: rgba(255,200,64,.95);
}
html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,Arial;color:var(--fg);background:#000}
.bg{position:fixed;inset:0;background:url("IMG_0907.jpeg") center/cover no-repeat;filter:saturate(1.1) contrast(1.05);transform:scale(1.02)}
.bg:after{content:"";position:absolute;inset:0;background:radial-gradient(1200px 800px at 30% 10%, rgba(146,69,255,.35), transparent 60%),radial-gradient(1200px 800px at 70% 90%, rgba(255,176,58,.20), transparent 60%),linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,.55))}
.wrap{position:relative;max-width:520px;margin:0 auto;padding:env(safe-area-inset-top) 16px 110px}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:14px 2px 10px}
.title{font-weight:900;font-size:34px;opacity:.85}
.pill{padding:10px 12px;border-radius:999px;background:rgba(0,0,0,.35);border:1px solid var(--stroke);font-weight:800;font-size:14px}
.card{background:var(--glass);border:1px solid var(--stroke);border-radius:22px;padding:16px;margin-top:10px}
.score{display:flex;align-items:center;gap:10px;font-size:44px;font-weight:900}
.score img{width:40px;height:40px}
.bigTap{margin-top:14px;height:280px;border-radius:22px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.20)}
.bigTap img{width:180px;height:180px;cursor:pointer}
.energy{display:flex;justify-content:space-between;margin-top:10px;font-weight:800}
.bar{height:12px;background:rgba(255,255,255,.15);border-radius:999px;margin-top:6px;overflow:hidden}
.bar div{height:100%;background:linear-gradient(90deg,#ffd166,#ff9f1c);width:50%}
.tabs{position:fixed;left:0;right:0;bottom:0;padding:12px}
.tabbar{display:flex;gap:8px;background:rgba(0,0,0,.45);border-radius:18px;padding:8px}
.tab{flex:1;padding:10px;border-radius:14px;background:none;border:none;color:#fff;font-weight:800}
.tab.active{background:rgba(255,255,255,.15)}
.hidden{display:none}

/* ====== КАПЧА ====== */
#abModal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:9999}
#abModal.hidden{display:none}
.abBox{background:#111;border-radius:18px;padding:16px;width:90%;max-width:360px}
.abBox h3{margin:0 0 8px}
.abBox input{width:100%;padding:12px;border-radius:12px;border:none;margin-top:8px;font-size:16px}
.abBtns{display:flex;gap:10px;margin-top:10px}
.abBtns button{flex:1;padding:12px;border-radius:12px;border:none;font-weight:800}
#abReopen{position:fixed;right:16px;bottom:90px;padding:10px 12px;border-radius:14px;background:rgba(0,0,0,.7);border:1px solid var(--stroke);color:#fff;font-weight:800}
#abReopen.hidden{display:none}
</style>
</head>

<body>
<div class="bg"></div>

<div class="wrap">
  <div class="topbar">
    <div class="title">TapVault</div>
    <div class="pill">PRO</div>
  </div>

  <div class="card">
    <div class="score">
      <img src="IMG_0933.webp">
      <span id="clicks">0</span>
    </div>

    <div class="bigTap">
      <img src="IMG_0933.webp" id="tapBtn">
    </div>

    <div class="energy">
      <span>Энергия</span>
      <span><span id="energy">250</span>/250</span>
    </div>
    <div class="bar"><div id="energyBar"></div></div>
  </div>
</div>

<!-- КАПЧА -->
<div id="abModal" class="hidden">
  <div class="abBox">
    <h3>Антибот</h3>
    <div id="abQ"></div>
    <input id="abInput" placeholder="Ответ">
    <div class="abBtns">
      <button id="abOk">Проверить</button>
      <button id="abCancel">Позже</button>
    </div>
  </div>
</div>
<button id="abReopen" class="hidden">Пройти проверку</button>

<script>
/* ====== СОСТОЯНИЕ ====== */
const MAX_ENERGY = 250;
const ENERGY_PER_SEC = 1;

let state = JSON.parse(localStorage.getItem("tv_state")) || {
  clicks: 0,
  energy: MAX_ENERGY,
  lastSeen: Date.now()
};

/* ====== ОФФЛАЙН ВОССТАНОВЛЕНИЕ ====== */
function restoreEnergy(){
  const now = Date.now();
  const diff = Math.floor((now - state.lastSeen)/1000);
  if(diff>0){
    state.energy = Math.min(MAX_ENERGY, state.energy + diff*ENERGY_PER_SEC);
    state.lastSeen = now;
    save();
  }
}

/* ====== АНТИБОТ ====== */
let captcha=null, blocked=false;
function runCaptcha(){
  if(captcha){openCaptcha();return}
  blocked=true;
  const a=2+Math.floor(Math.random()*8);
  const b=2+Math.floor(Math.random()*8);
  captcha={q:`${a}+${b}`,ans:String(a+b)};
  openCaptcha();
}
function openCaptcha(){
  abQ.textContent=`Сколько будет ${captcha.q}?`;
  abModal.classList.remove("hidden");
  abReopen.classList.add("hidden");
}
function closeCaptcha(reopen=true){
  abModal.classList.add("hidden");
  if(reopen)abReopen.classList.remove("hidden");
}
abOk.onclick=()=>{
  if(abInput.value.trim()===captcha.ans){
    blocked=false;captcha=null;closeCaptcha(false);
  }
};
abCancel.onclick=()=>closeCaptcha(true);
abReopen.onclick=()=>openCaptcha();

/* ====== ТАП ====== */
tapBtn.onclick=()=>{
  if(blocked){runCaptcha();return}
  if(state.energy<=0)return;
  state.energy--;state.clicks++;
  save();render();
};

/* ====== UI ====== */
function render(){
  clicks.textContent=state.clicks.toLocaleString();
  energy.textContent=state.energy;
  energyBar.style.width=(state.energy/MAX_ENERGY*100)+"%";
}
function save(){
  state.lastSeen=Date.now();
  localStorage.setItem("tv_state",JSON.stringify(state));
}

/* ====== ЖИЗНЕННЫЙ ЦИКЛ ====== */
restoreEnergy();
render();
setInterval(()=>{restoreEnergy();render()},1000);
document.addEventListener("visibilitychange",()=>{if(document.hidden)save()});
</script>
</body>
</html>
